<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Educademy â€” Profile</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/Studentdashboard.css') }}">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <div class="navbar">
        <button class="logo" onclick="location.href='/'" style="background:none;border:none;cursor:pointer;color:#2d7be5;font-size:1.7em;font-weight:bold;letter-spacing:1px;user-select:none;">Educademy</button>
        <nav class="nav-links">
            <a href="/" class="nav-link">Home</a>
            <a href="/#about" class="nav-link">About</a>
            <a href="/contact" class="nav-link">Contact</a>
            <button class="profile-btn" onclick="location.href='/profile'">ğŸ‘¤</button>
        </nav>
  </div>

  <section class="welcome-section" aria-labelledby="welcome-heading">
    <div class="profile-wrapper" style="position:relative;">
      <img id="avatarImg" class="avatar" src="https://images.unsplash.com/photo-1583440194369-ac78b451536a?w=600&auto=format&fit=crop&q=60" alt="Profile picture">
      <label class="avatar-edit" title="Change avatar">
        <input id="avatarInput" type="file" accept="image/*" style="display:none">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="display:block">
          <path d="M16 3h5v5" stroke="#222" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M21 3L13 11" stroke="#222" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
          <path d="M3 21v-4a2 2 0 0 1 2-2h4" stroke="#222" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
      </label>
      <div class="status-dot"></div>
    </div>

    <h1 id="welcome-heading" class="welcome-title">Welcome back, {{ session.get('username', 'Student') }}!</h1>
    <p class="welcome-sub">Hereâ€™s a snapshot of your learning progress.</p>
  </section>

  <main class="main" role="main">
    <section class="card" aria-labelledby="progress-heading">
      <h3 id="progress-heading">ğŸ“Š Learning Analytics</h3>
      <div class="chart-container">
        <canvas id="quizTrend"></canvas>
      </div>
    </section>

    <section class="card">
      <h3>ğŸ† Average Score by File</h3>
      <canvas id="scoreByFile"></canvas>
    </section>

    <section class="card">
      <h3>ğŸ“ Summaries by Type</h3>
      <canvas id="summaryByType"></canvas>
    </section>
  </main>

  <footer>
    <div class="footer-grid">
      <div>
        <h4>Educademy</h4>
        <p style="color:var(--muted); margin:8px 0 0">
          Empowering learners worldwide with interactive quizzes and comprehensive tracking.
        </p>
      </div>
      <div>
        <h4>Quick Links</h4>
        <a href="/">Dashboard</a><a href="#">Courses</a><a href="/mcq">Quizzes</a><a href="/profile">Progress</a>
      </div>
      <div>
        <h4>Support</h4>
        <a href="#">Help Center</a><a href="/contact">Contact Us</a><a href="#">Privacy Policy</a><a href="#">Terms of Service</a>
      </div>
      <div>
        <h4>Connect</h4>
        <a href="#">GitHub</a><a href="#">Twitter</a><a href="#">LinkedIn</a><a href="mailto:adarsh.kushwaha_cs23@gla.ac.in">Email</a>
      </div>
    </div>
    <div class="copyright">&copy; 2025 Educademy. All rights reserved.</div>
  </footer>

  <script>
    const currentUser = "{{ session.get('username', '') }}";

    async function loadAnalytics(student) {
      try {
        const response = await fetch(`/analytics_summary/${student}`);
        const data = await response.json();

        if (window.quizChart) window.quizChart.destroy();
        if (window.fileChart) window.fileChart.destroy();
        if (window.typeChart) window.typeChart.destroy();

        const quizCtx = document.getElementById("quizTrend");
        window.quizChart = new Chart(quizCtx, {
          type: 'line',
          data: {
            labels: data.quiz_trend.map(q => new Date(q.date).toLocaleDateString()),
            datasets: [{
              label: 'Quiz %',
              data: data.quiz_trend.map(q => q.percentage),
              borderColor: '#2d7be5',
              backgroundColor: 'rgba(45, 123, 229, 0.2)',
              fill: true,
              tension: 0.3
            }]
          },
          options: { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }
        });

        const fileCtx = document.getElementById("scoreByFile");
        window.fileChart = new Chart(fileCtx, {
          type: 'bar',
          data: {
            labels: data.score_by_file.map(s => s.file || 'N/A'),
            datasets: [{
              label: 'Average %',
              data: data.score_by_file.map(s => s.avg),
              backgroundColor: '#6ba8ff'
            }]
          },
          options: { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }
        });

        const typeCtx = document.getElementById("summaryByType");
        window.typeChart = new Chart(typeCtx, {
          type: 'doughnut',
          data: {
            labels: data.summary_types.map(s => s.type),
            datasets: [{
              data: data.summary_types.map(s => s.count),
              backgroundColor: ['#fbbf24', '#34d399', '#f87171', '#60a5fa']
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { position: 'bottom' } }
          }
        });

      } catch (err) {
        console.error(err);
        alert("Error loading analytics. Check console for details.");
      }
    }

    if (currentUser) loadAnalytics(currentUser);
  </script>

  <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
</body>
</html>
