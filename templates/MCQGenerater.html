<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MCQ Generator</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/MCQGenerater.css') }}">
</head>
<body>

  <!-- NAVBAR -->
  <div class="navbar">
      <button class="logo" onclick="location.href='/'" style="background:none;border:none;cursor:pointer;color:#2d7be5;font-size:1.7em;font-weight:bold;letter-spacing:1px;user-select:none;">Educademy</button>
      <nav class="nav-links">
          <a href="/" class="nav-link">Home</a>
          <a href="/#about" class="nav-link">About</a>
          <a href="/contact" class="nav-link">Contact</a>
          <button class="profile-btn" onclick="location.href='/profile'">üë§</button>
      </nav>
  </div>

  <!-- HEADER SECTION -->
  <div class="welcome-section">
      <div class="welcome-icon"></div>
      <h2>MCQ Generator</h2>
      <p>Turn any notes or document into interactive quizzes!</p>
  </div>

  <!-- FORM SECTION -->
  <div class="container">
    <form id="mcqForm" enctype="multipart/form-data">
      <textarea name="text" placeholder="Paste your text here..." aria-label="Text input"></textarea>
      <p class="upload-label">OR Upload a File (PDF/DOCX):</p>
      <input type="file" name="file" aria-label="Upload file">
      <button type="submit">Generate MCQs</button>
    </form>

    <div id="loading" style="display:none;">‚è≥ Generating MCQs...</div>
    <div id="mcqResult"></div>
    <div id="quizScore"></div>
  </div>

  <footer>
    <p>¬© 2025 Educademy | All Rights Reserved</p>
  </footer>

  <!-- ‚≠ê FINAL FIXED JAVASCRIPT ‚≠ê -->
  <script>
    let correctAnswers = [];  
    let currentFilename = "text_input";

    // üìå Generate MCQs on Submit
    document.getElementById("mcqForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      document.getElementById("loading").style.display = "block";

      const formData = new FormData(this);

      if (formData.get("file")) {
        currentFilename = formData.get("file").name;
      }

      const response = await fetch("/generate_quiz", {
        method: "POST",
        body: formData
      });

      const data = await response.json();
      document.getElementById("loading").style.display = "none";

      if (data.error) {
        document.getElementById("mcqResult").innerHTML = `<p style="color:red;">${data.error}</p>`;
        return;
      }

      // ‚ùó USE answer FROM BACKEND
      correctAnswers = data.mcqs.map(q => q.answer); 
      renderQuiz(data.mcqs);
    });

    // üìå Render Questions
    function renderQuiz(mcqs) {
      let html = `<form id="quizForm">`;
      mcqs.forEach((q, i) => {
        html += `
        <div class="question-block">
          <p><b>Q${i + 1}. ${q.question}</b></p>
          ${q.options.map(opt => `
            <label>
              <input type="radio" name="q${i}" value="${opt}"> ${opt}
            </label><br>`).join("")}
        </div><hr>`;
      });
      html += `<button type="button" onclick="submitQuiz(${mcqs.length})">Submit Quiz</button></form>`;
      document.getElementById("mcqResult").innerHTML = html;
    }

    // üìå Check Answers + Store in DB
    async function submitQuiz(totalQuestions) {
      let score = 0;

      correctAnswers.forEach((correct, i) => {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if (selected && selected.value === correct) score++;
      });

      const percentage = (score / totalQuestions) * 100;

      document.getElementById("quizScore").innerHTML = `
        <h2>Your Score: ${score}/${totalQuestions} (${percentage.toFixed(2)}%)</h2>
      `;

      // üìå SAVE TO DB
      await fetch("/submit_mcqs", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          score: score,
          total: totalQuestions,
          filename: currentFilename
        })
      });

      alert("Quiz saved successfully! Check your dashboard.");
    }
  </script>

</body>
</html>
